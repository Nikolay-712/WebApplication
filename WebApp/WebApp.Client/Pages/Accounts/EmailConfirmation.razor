@page "/confirm-email"
@inject IAccountClientService _accountClient
@inject NavigationManager _navigationManager

<DisplayErrorMessage Message="@ErrorMessage" />

@code {
    private ResponseContent ResponseContent = new();
    private string ErrorMessage = string.Empty;

    [SupplyParameterFromQuery]
    private string? identifier { get; set; }

    [SupplyParameterFromQuery]
    private string? token { get; set; }


    protected override async Task OnInitializedAsync()
    {

        if (string.IsNullOrEmpty(identifier) || string.IsNullOrEmpty(token))
        {
            _navigationManager.NavigateTo("/");
            return;
        }

        ConfirmEmailRequestModel requestModel = new()
            {
                Identifire = identifier,
                Token = token
            };

        ResponseContent = await _accountClient.ConfirmEmailAsync(requestModel);
        if (ResponseContent.ErrorResponse is null)
        {
            _navigationManager.NavigateTo("login");
            return;
        }

        ErrorMessage = ResponseContent.ErrorResponse.Message;
    }
}
